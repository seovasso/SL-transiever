= ApbCommunicator
:Date:      31.11.2017
:Revision:  0.5
:toc:       right
:icons:     font
:source-highlighter: rouge
:table-caption:     Таблица
:listing-caption:   Код
:chapter-label:     Глава
:toc-title:         Оглавление
:version-label:     Версия
:figure-caption:    Рисунок
:imagesdir:         ./../img/

[[communicator-main-description]]
== Описание
Модуль используется в проекте приемопередатчика SL канала для обработки APB транзакций и помещения/считывания полученных данных из входного и выходного асинхронных буферов

[[communicator-top-level-description]]
== Описание верхнего уровня

[[communicator-input-signals]]
=== Входные сигналы

.APB-связанные сигналы
* pclk - сигнал тактовой частоты
* preset_n -  сигнал сброса
* [15:0] paddr -  шина адреса
* psel -  сигнал выбора устройства
* penable -  сигнал разрешения работы
* pwrite -  сигнал выбора чтения или записи
* [31:0] pwdata - шина записи данных

.Сигналы входного и выходного буферов
* fifo_read_empty - сигнализирует что входной буфер пуст
* fifo_write_full - сигнализирует что выходной буфер полон
* [33:0] fifo_read_data - шина данных входного буфера

[[communicator-output-signals]]
=== Выходные сигналы

.APB-связанные сигналы
* [31:0] prdata - шина чтения данных
* pready - сигнал готовности к чтению или записи данных

.Сигналы входного и выходного буферов
* fifo_read_inc - сигнал для чтения из входного буфера
* [33:0] fifo_write_data - шина данных выходного буфера
* fifo_write_inc - сигнал для записи в выходной буфера

[[communicator-inout-signals]]
=== Двунаправленные сигналы
Отсутствуют


[[communicator-programm-model]]
== Программная модель
.Пользователю для работы доступно несколько регистров:
. Конфигурационный
. Состояния
. Данных (при операции чтения это регистр приема, а при операции записи - отправки )
. Адреса управляемого устройства (мриемника или передатчика)

=== Описание работы модуля

В ходе работы, модуль принимает транзакции APB шины и обрабатывает их следующим образом:
При транзакции записи в соотвествующий регистр, данные для записи помещаются в выходной буфер, разширенные до 34 разрядов, где 34 и 33 разряд  представляют собой модификатор, одназначно задающий регистр, для которого предназначаются эти данные.
При транзакции чтения на APB шину подается содержимое одного из четырех соотвествующих внутренних регистров модуля, в который предварительно были записаны данные из выходного буфера.

Когда транзакций нет, а сообщения во входном буфере есть, то модуль переписывает данные из буфера в регистры, руководствуясь модификатором.

.Значения модификаторов для разных регистров
[cols="2*^", width=99%]
|===
|Регистр                   |Значение модификатора
|Конфигурационый           | 2'd0
|Данных                    | 2'd1
|Состояния                 | 2'd2
|Адреса устройства         | 2'd3
|===
[[state-machine]]
== Конечный автомат
image::image_ApbCommunicator_SM.png[title="Конечный автомат модуля SlTransmitter", align="center"]
