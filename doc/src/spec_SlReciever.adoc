= SlReciever
:Date:      13.10.2017
:Revision:  0.1
:toc:       right
:icons:     font
:source-highlighter: rouge
:table-caption:     Таблица
:listing-caption:   Код
:chapter-label:     Глава
:toc-title:         Оглавление
:version-label:     Версия
:figure-caption:    Рисунок
:imagesdir:         ./../img/

[[rec-main-description]]
== Описание
Данный проект подразумевает реализацию RTL-описания на языке Verilog одноканального приемника SL-канала.

[[rec-top-level-description]]
== Описание верхнего уровня

[[rec-input-signals]]
=== Входные сигналы
* rst_n - асинхронный общий сигнал сброса
* clk - сигнал тактовой частоты
* [31:0] D_in - порт для записи данных в регистры
* wr_en - После установки в 1 в выбранный портом addr регистр записывается необходимое число
* addr - адрес регистра "0" - регистр данных, "1" - регистр конфигурации и состояния
* serial_line_zeroes_a - асинхронный вход линии нулей SL-канала
* serial_line_ones_a - асинхронный вход линии единий SL-канала

[[rec-output-signals]]
=== Выходные сигналы
* [31:0] D_out - порт для чтения регистров
* irq - вывод прерывания

[[rec-inout-signals]]
=== Двунаправленные сигналы

Отсутствуют.

[[rec-programm-model]]
== Программная модель
Пользователю для работы доступно несколько регистров:

* Регистр конфигурации и состояния (config_r и status_r)
* Данных к отправке (txdata_r)

=== Регистр конфигурации и состояния

Регистр конфигурации и состояния состоит из двух объединеных  регистров -
регистра конфигурации и регистра состояния. Регистру конфигурации соответвуют младшие 16 разрядов, регистру состояния - старшие.

.Назначение разрядов регистра конфигурации  (config_r)
[cols="16*^", width=99%]
|===
|0     |1     |2 |3 |4 |5 |6    |7    |8    |9    |10   |11   |12   |13   |14    |15
|SR  6+|BC[6:0]                 |IRQM |PCE  |Res* |Res* |Res* |Res* |Res* |Res*  |Res*
|===

.Описание разрядов регистра конфигурации (config_r)
. SR - soft reset, включает (SR=1) и выключает (SR=0) приемник
. BC - bit count, количество бит в слове
. IRQM - interrupt request mode, разрешение(IRQM = 1) или запрещение(IRQM = 0) работы прерываний модуля
. PCE - parity check enable, разрешение контроля четности(PCE = 1), или запрещение(PCE = 0)

.Назначение разрядов регистра состояния (status_r)
[cols="16*^", width=99%]
|===
|16    |17   |18   |19   |20   |21   |22   |23      |24    |25    |26    |27   |28   |29   |30   |31
|WLC   |WRP |Res*  |WRF  |PEF  |LEF  |Res* |Res*  3+|IRQSM |IRQCC |IRQIC |Res* |Res* |Res* |Res* |Res*
|===

.Описание разрядов регистра состояния (status_r)
. WLC - word length check, результат проверки длины полученного слова на равенство значению BC регистра config_r, WLC = 1, если значения не равны
. WRP - word receiving process, флаг идущего процесса приема слова по SL-каналу
. Res* - Зарезервированно
. WRF - word received flag, флаг успешно завершенного приема слова
. PEF - parity error flag, флаг наличия(PEF = 1) ошибки четности принятого слова
. LEF - level error on line flag, флаг наличия ошибки уровня напряжения на линии SL-канала
. IRQSM - interrupt request of sent message
. IRQCC - interrupt request of configuration changed
. IRQIC - interrupt request of incorrect configuration

=== Регистр полученных данных
buffered_data_r[31:0]

.Назначение разрядов регистра полученных данных (buffered_data_r)
[cols="1*^", width=99%]
|===
|0 - 31
|Data
|===

Data - данные к отправке.


== Описание работы

Модуль принимает SL-сообщения. Сообщения могут иметь четную длинну от 8 до 32 бит.
 Бит четности проверяется автоматически. Частота импульсов принимаемых сообщений может меняться от 500кГц
 до 2МГц (при частоте тактового сигнала = 16МГц).

.Запись и чтение регистров
Управление модулем осуществляется путем записи/чтения регистров.

Запись в регистры осуществляется подачей записываемой информации на шину d_in,
адреса на порт addr,
и единицы на порт wr_en. В режиме отправки сообщения (поле регистра состояния SIP  = "1")
запись в регистр конфигурации и состояния возможна, но при изменении конфигурационной
части корректность принятия сообщения не гарантируется. Попытка записать в конфигурационный регистр некорректные
параметры игнорируется. Попытка записать данные игнорируется.

Для чтения регистра необходимо подать адрес на порт addr и считать
информацию с шины d_out.

.Смена конфигурации
Для изменения конфигурации приемника необходимо перезаписать регистр конфигурации и состояния.
В конфигурационной части вы можете установить длинну слова, разрешение вызова прерываний, проверку четности или включить/выключить модуль.

.Прием сообщений
После приема сообщения выставляется соотвествующий флаг, а также возникает прерывание. В регистре данных хранится последнее успешно принятое сообщение.


.Прерывания
Прерывания вызываются если поле регистра конфигурации IRQM = 1 и:
* Успешно принято сообщение
* Была предпринята попытка записать некорректные данные в конфигурационный регистр
* Произошло изменеие конфигурации в процессе отправки сообщения
Причину возникновения можно посмотреть в соотвествующих полях регистра состояния.
Для сбрасывания прерываний, вам необходимо считать регистр конфигурации и состояния и
записать считанное снова, занулив биты причины прерывания при записи единиц в поле IRQC значение поле не изменяется.

.Выключение модуля
При выключении приемника (поле регистра конфигурации SR = "1"), приемник прекращает прием текущего сообщения.


[[rec-state-machine]]
== Конечный автомат

image::image_SlReciever_SM.png[title="Конечный автомат модуля SlReciever", align="center"]
